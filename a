import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from statsmodels.tsa.arima.model import ARIMA
from statsmodels.graphics.tsaplots import plot_acf, plot_pacf
from sklearn.metrics import mean_absolute_error, mean_squared_error

# Load dataset
url = "https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv"
df = pd.read_csv(url, parse_dates=["Month"], index_col="Month")

print("Dataset shape:", df.shape)
print(df.head())

# Missing values
print("\nMissing values per column:\n", df.isnull().sum())

# Plot series
plt.figure(figsize=(10, 6))
plt.plot(df.index, df["Passengers"], label="Passengers")
plt.title("Monthly Air Passengers (1949-1960)")
plt.xlabel("Date")
plt.ylabel("Number of Passengers")
plt.legend()
plt.show()

# ACF & PACF
fig, axes = plt.subplots(1, 2, figsize=(14, 5))
plot_acf(df["Passengers"], ax=axes[0], lags=30)
plot_pacf(df["Passengers"], ax=axes[1], lags=30)
plt.show()

# Train-test split
train_size = int(len(df) * 0.8)
train, test = df.iloc[:train_size], df.iloc[train_size:]

# ARIMA model
model = ARIMA(train["Passengers"], order=(2, 1, 2))
model_fit = model.fit()
print(model_fit.summary())

# Forecast
forecast = model_fit.forecast(steps=len(test))
forecast = pd.Series(forecast, index=test.index)

# Evaluation
mae = mean_absolute_error(test["Passengers"], forecast)
rmse = np.sqrt(mean_squared_error(test["Passengers"], forecast))
mape = np.mean(np.abs((test["Passengers"] - forecast) / test["Passengers"])) * 100

print(f"MAE:  {mae:.3f}")
print(f"RMSE: {rmse:.3f}")
print(f"MAPE: {mape:.2f}%")

# Plot forecast
plt.figure(figsize=(10, 6))
plt.plot(train.index, train["Passengers"], label="Train")
plt.plot(test.index, test["Passengers"], label="Test")
plt.plot(forecast.index, forecast, label="Forecast")
plt.title("ARIMA Forecast vs Actuals")
plt.xlabel("Date")
plt.ylabel("Passengers")
plt.legend()
plt.show()
